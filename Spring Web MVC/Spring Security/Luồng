Luá»“ng: https://viblo.asia/p/van-de-bao-mat-api-bang-spring-security-jvElao66Kkw
https://viblo.asia/p/lam-sao-bao-mat-ung-dung-spring-voi-spring-security-va-jwt-yZjJYKXbVOE
https://viblo.asia/p/huong-dan-spring-security-co-ban-de-hieu-OeVKBdedlkW
jwt: https://viblo.asia/p/huong-dan-spring-security-jwt-json-web-token-hibernate-oOVlYGmoK8W

ğŸ” Ã tÆ°á»Ÿng: CÃ¡ch Spring Security biáº¿t ngÆ°á»i dÃ¹ng Ä‘Ã£ Ä‘Äƒng nháº­p hay chÆ°a

Khi báº¡n Ä‘Äƒng nháº­p qua form (vÃ­ dá»¥ /login):
1ï¸âƒ£ Spring Security kiá»ƒm tra thÃ´ng tin ngÆ°á»i dÃ¹ng (qua UserDetailsService, DB, v.v.)
2ï¸âƒ£ Náº¿u há»£p lá»‡ â†’ nÃ³ ghi láº¡i ngÆ°á»i dÃ¹ng Ä‘ang Ä‘Äƒng nháº­p vÃ o má»™t vÃ¹ng Ä‘áº·c biá»‡t:
ğŸ‘‰ SecurityContextHolder (chá»©a Ä‘á»‘i tÆ°á»£ng Authentication)
3ï¸âƒ£ Authentication nÃ y lÆ°u thÃ´ng tin nhÆ°:

principal: ngÆ°á»i dÃ¹ng hiá»‡n táº¡i (username, vai trÃ², v.v.)
authorities: danh sÃ¡ch quyá»n
authenticated: cá» true/false (Ä‘Ã£ Ä‘Äƒng nháº­p chÆ°a)

Sau khi Ä‘Äƒng nháº­p thÃ nh cÃ´ng, má»i request gá»­i lÃªn (dÃ¹ lÃ  trang khÃ¡c) Spring Security sáº½ tá»± gáº¯n láº¡i thÃ´ng tin user tá»« session â€” báº¡n khÃ´ng cáº§n lÃ m thá»§ cÃ´ng:
SecurityContext
 â””â”€â”€ Authentication
      â”œâ”€â”€ principal
      â”œâ”€â”€ authorities
      â””â”€â”€ authenticated = true


Authentication = thÃ´ng tin xÃ¡c thá»±c hiá»‡n táº¡i
principal = thÃ´ng tin ngÆ°á»i dÃ¹ng

â¡ï¸ principal cÃ³ thá»ƒ lÃ  nhá»¯ng kiá»ƒu gÃ¬?
TrÆ°á»ng há»£p 1: ChÆ°a Ä‘Äƒng nháº­p
principal = "anonymousUser"

TrÆ°á»ng há»£p 2: DÃ¹ng Spring Security máº·c Ä‘á»‹nh
principal instanceof org.springframework.security.core.userdetails.User

VÃ­ dá»¥:
User(username=user, password=[PROTECTED], authorities=[ROLE_USER])

TrÆ°á»ng há»£p 3: DÃ¹ng UserEntity + CustomUserDetails (phá»• biáº¿n nháº¥t)
principal instanceof CustomUserDetails

public class CustomUserDetails implements UserDetails {
    private UserEntity user;
}

â¡ï¸ principal chÃ­nh lÃ  CustomUserDetails

â¡ï¸Láº¥y principal báº±ng cÃ¡ch nÃ o?
CÃ¡ch 1: Tá»« SecurityContext
Authentication auth =
    SecurityContextHolder.getContext().getAuthentication();

Object principal = auth.getPrincipal();

CÃ¡ch 2: Ã‰p kiá»ƒu (thÆ°á»ng dÃ¹ng)
CustomUserDetails user =
    (CustomUserDetails) auth.getPrincipal();

CÃ¡ch 3: CÃ¡ch chuáº©n nháº¥t (Controller)
@GetMapping("/profile")
public String profile(@AuthenticationPrincipal CustomUserDetails user) {
    System.out.println(user.getUsername());
    return "profile";
}
