Browser chá»n áº£nh
 â†“
POST /api/files/product
 â†“
Spring lÆ°u file vÃ o /uploads/products/
 â†“
Backend tráº£ URL /uploads/products/a.jpg
 â†“
<img src="/uploads/products/a.jpg">
 â†“
FileConfig map URL â†’ filesystem
 â†“
áº¢NH HIá»†N


1ï¸âƒ£ Táº¡o file config: FileConfig.java
Viá»‡c khai bÃ¡o ResourceHandler nháº±m nÃ³i vá»›i Spring ráº±ng cÃ¡c file tÄ©nh Ä‘Æ°á»£c phá»¥c vá»¥ tá»« thÆ° má»¥c uploads náº±m ngoÃ i classpath, cÃ¹ng cáº¥p vá»›i src, thay vÃ¬ náº±m trong static.
Äiá»u nÃ y cho phÃ©p truy cáº­p file upload qua URL dáº¡ng:
http://localhost:8080/uploads/products/iphone.jpgnhÆ° thÃ´ng thÆ°á»ng Ä‘á»ƒ ko bá»‹ nÃ©n thÃ nh 1 jar, náº¿u Ä‘á»ƒ trong static sáº½ bá»‹ nÃ©n thÃ nh jar vÃ  khi upload file ko thá»ƒ ghi thÃªm vÃ o trong static khi app Ä‘ang cháº¡y
KhÃ´ng nÃªn lÆ°u file upload trong static vÃ¬ static lÃ  tÃ i nguyÃªn build-time vÃ  sáº½ bá»‹ Ä‘Ã³ng gÃ³i vÃ o JAR khi build á»©ng dá»¥ng. Trong khi Ä‘Ã³, file upload lÃ  dá»¯ liá»‡u runtime, phÃ¡t sinh khi á»©ng dá»¥ng Ä‘ang cháº¡y.Náº¿u cá»‘ upload vÃ o static thÃ¬ sao?
âŒ TrÃªn local (cháº¡y IDE)
CÃ³ thá»ƒ â€œtáº¡mâ€ ghi Ä‘Æ°á»£c

âŒ Khi deploy: Má»—i láº§n build láº¡i bá»‹ máº¥t sáº¡ch file
JAR read-only
Docker image read-only
Server khÃ´ng cho ghi
ğŸ‘‰
package com.example.online_shop.config;
@Configuration
public class FileConfig implements WebMvcConfigurer {
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:uploads/");
    }
}

2ï¸âƒ£ Viáº¿t hÃ m service xá»­ lÃ­:
package com.example.online_shop.service.impl;
@Service
public class FileServiceImpl implements FileService {
    private final String baseUploadDir = "uploads/";
    @Override
    public String saveImage(MultipartFile file, String folder) throws IOException {
        if(file.isEmpty()) return null;
        String finalDir = baseUploadDir + folder + "/";

// ğŸ‘‰ Táº¡o Ä‘á»‘i tÆ°á»£ng File Ä‘áº¡i diá»‡n cho Ä‘Æ°á»ng dáº«n thÆ° má»¥c Ä‘á»ƒ kiá»ƒm tra vÃ  táº¡o thÆ° má»¥c trÆ°á»›c khi ghi file:
TrÆ°á»ng há»£p	
"uploads/products/"	ğŸ“ Folder
"uploads/products/a.jpg"	ğŸ–¼ File        

        File dir = new File(finalDir);
        if(!dir.exists()) dir.mkdirs(); //Táº¡o thÆ° má»¥c náº¿u chÆ°a tá»“n táº¡i

        String fileName = System.currentTimeMillis() + "_" + file.getOriginalFilename();

// Táº¡o ra má»™t Ä‘á»‘i tÆ°á»£ng Path: uploads/products/1706789012345_iphone.jpg, VÃ¬ API ghi file cá»§a Java khÃ´ng nháº­n String, mÃ  nháº­n Path (LÃ  Ä‘á»‘i tÆ°á»£ng filesystem) :
        Path filePath =  Paths.get(finalDir+fileName);  
        Files.copy(
                file.getInputStream(),
                filePath,
                StandardCopyOption.REPLACE_EXISTING
        );

        return "/uploads/" + folder + "/" + fileName;
    }
}

3ï¸âƒ£ Controller
@RestController
@RequestMapping("/api/files")
public class FileApi {
    @Autowired
    private FileService fileService;

    @PostMapping("/product")
    public ResponseEntity<?> uploadProductImage(@RequestParam("files") MultipartFile file) {
        try{
            String url = fileService.saveImage(file,"products");
            return ResponseEntity.ok().body(url);
        }
        catch (IOException e){
            return ResponseEntity.internalServerError().body("Lá»—i: " + e.getMessage());
        }
    }
ğŸ”§ HOáº¶C
    @PostMapping("/product")
    public ResponseEntity<List<String>> uploadProductImages(
            @RequestParam("files") List<MultipartFile> files
    ) throws IOException {
    
        List<String> urls = new ArrayList<>();
    
        for (MultipartFile f : files) {
            urls.add(fileService.saveImage(f, "products"));
        }
    
        return ResponseEntity.ok(urls);
    }

}
4ï¸âƒ£ FRONTEND
     <div>
         <input type="file" id="imageInput" accept="image/*" multiple>
         <button type="button" onclick="uploadFile()">ThÃªm áº£nh</button>
         <div id="preview" style="display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap;"></div>
     </div>
async function uploadFile() {
    const fileInput = document.getElementById('imageInput');
    if (fileInput.files.length === 0) return;

    const formData = new FormData();
    for (const file of fileInput.files) {
        formData.append('files', file);
    }

    const response = await fetch('/api/files/product', {
        method: 'POST',
        body: formData
    });

    if (!response.ok) {
        alert("Upload lá»—i");
        return;
    }

    const imageUrls = await response.json(); // â¬… nháº­n máº£ng URL
    const preview = document.getElementById('preview');
    Äá»ƒ hiá»‡n áº£nh á»Ÿ FRONTEND khi áº¥n 'thÃªm áº£nh'
    imageUrls.forEach(url => {
        const img = document.createElement('img');
        img.src = url;
        img.width = 150;
        img.style.marginRight = "10px";
        preview.appendChild(img); // â¬… KHÃ”NG GHI ÄÃˆ
    });
}


5ï¸âƒ£ Náº¿u muá»‘n hiá»‡n áº£nh ngay 

// 1. HÃ m nÃ y giÃºp hiá»‡n áº£nh NGAY KHI CHá»ŒN FILE (ChÆ°a cáº§n báº¥m nÃºt)
document.getElementById('imageInput').addEventListener('change', function() {
    const preview = document.getElementById('preview');
    preview.innerHTML = ''; // XÃ³a preview cÅ©

    Array.from(this.files).forEach(file => {
        const url = URL.createObjectURL(file); // Táº¡o Ä‘Æ°á»ng dáº«n táº¡m thá»i
        const imgHtml = `
            <div class="img-box" style="position:relative; border:1px solid #ddd; padding:5px;">
                <img src="${url}" width="100" height="100" style="object-fit:cover;">
                <p style="font-size:10px; text-align:center;">Chá» upload...</p>
            </div>`;
        preview.insertAdjacentHTML('beforeend', imgHtml);
    });
});

// 2. HÃ m Upload (Cáº­p nháº­t giao diá»‡n sau khi Server tráº£ vá» link tháº­t)
async function uploadFile() {
    const fileInput = document.getElementById('imageInput');
    const files = fileInput.files;
    
    for (let file of files) {
        const formData = new FormData();
        formData.append('file', file);

        const response = await fetch('/api/files/upload-image', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            const serverUrl = await response.text();
            console.log("áº¢nh Ä‘Ã£ lÆ°u trÃªn server:", serverUrl);
            // MÃ y cÃ³ thá»ƒ Ä‘á»•i mÃ u viá»n hoáº·c thÃªm icon "TÃ­ch xanh" vÃ o áº£nh Ä‘Ã£ upload xong á»Ÿ Ä‘Ã¢y
        }
    }
    alert("ÄÃ£ upload toÃ n bá»™ áº£nh thÃ nh cÃ´ng!");
}
6ï¸âƒ£
