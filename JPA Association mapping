https://stackjava.com/hibernate/hibernate-fetchtype-la-gi-phan-biet-fetchtype-lazy-voi-eager.html
https://thorben-janssen.com/best-practices-many-one-one-many-associations-mappings/

VD:
â™¦ Entity PurchaseOrder:
@Entity
@Table(name = "purchase_order")
public class PurchaseOrder {
    @Id
    private Long id;
}
â™¦ Entity Item
@Entity
@Table(name = "item")
public class Item {
    @Id
    private Long id;

    @ManyToOne
    @JoinColumn(name = "fk_order") // cá»™t nÃ y náº±m trong báº£ng item trong db
    private PurchaseOrder order;
}
ğŸ«µ - @Entity â†’ Hibernate/JPA biáº¿t Ä‘Ã¢y lÃ  báº£ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.
   - @Table(name = "purchase_order") â†’ chá»‰ Ä‘á»‹nh tÃªn báº£ng trong DB lÃ  purchase_order (náº¿u khÃ´ng khai bÃ¡o, Hibernate sáº½ dÃ¹ng tÃªn class).
   - @Id private Long id; â†’ cá»™t primary key cá»§a báº£ng purchase_order.
   - private PurchaseOrder order: field kiá»ƒu entity â†’ cÃ³ thá»ƒ truy xuáº¥t Item.order.getId() hoáº·c Item.order Ä‘á»ƒ láº¥y toÃ n bá»™ thÃ´ng tin PurchaseOrder. Hibernate tá»± Ä‘á»™ng quáº£n lÃ½ giÃ¡ trá»‹ cá»™t fk_order khi persist/update entity Item.
   - item.getOrder().getId()
	+ item.getOrder() â†’ tráº£ vá» entity PurchaseOrder liÃªn káº¿t vá»›i Item.
    + .getId() â†’ truy cáº­p field id cá»§a entity PurchaseOrder.
    + Hibernate biáº¿t order trá» tá»›i báº£n ghi nÃ o nhá» cá»™t fk_order trong báº£ng item. 
ğŸŸ¢ FetchType.LAZY and FetchType.EAGER
- FetchType.EAGER:
	Theo chuáº©n JPA, vá»›i cÃ¡c quan há»‡ kiá»ƒu to-one (vÃ­ dá»¥ @ManyToOne, @OneToOne) thÃ¬ máº·c Ä‘á»‹nh sáº½ lÃ  FetchType.EAGER.
	NghÄ©a lÃ : khi báº¡n load 1 entity, Hibernate sáº½ tá»± Ä‘á»™ng load luÃ´n quan há»‡ liÃªn káº¿t (vÃ­ dá»¥ Item thÃ¬ load thÃªm PurchaseOrder Ä‘i kÃ¨m).
	Náº¿u chá»‰ load 1 báº£n ghi, thÃ¬ cÅ©ng chá»‰ cáº§n thÃªm 1 query phá»¥ ná»¯a â†’ khÃ´ng tá»‘n kÃ©m láº¯m.
	NhÆ°ng náº¿u báº¡n láº¥y danh sÃ¡ch nhiá»u Item, thÃ¬ váº¥n Ä‘á» náº£y sinh: Hibernate pháº£i cháº¡y thÃªm 1 query phá»¥ cho má»—i báº£n ghi Item Ä‘á»ƒ láº¥y PurchaseOrder.
	N+1 SELECT problem (váº¥n Ä‘á» N+1 truy váº¥n)

VÃ­ dá»¥:
List<Item> items = em.createQuery("SELECT i FROM Item i", Item.class).getResultList();

Hibernate sáº½ cháº¡y 1 query Ä‘á»ƒ láº¥y táº¥t cáº£ Item.
Sau Ä‘Ã³, vá»›i má»—i Item, nÃ³ tá»± Ä‘á»™ng cháº¡y thÃªm 1 query riÃªng Ä‘á»ƒ láº¥y PurchaseOrder. (Hibernate tá»± Ä‘á»™ng load luÃ´n quan há»‡ liÃªn káº¿t)
Náº¿u cÃ³ 100 item â†’ 1 query ban Ä‘áº§u + 100 query phá»¥ = 101 query â†’ ráº¥t cháº­m.

ğŸ”¶Log SQL minh há»a:
// Query Ä‘áº§u tiÃªn load táº¥t cáº£ Item
	select item0_.id, item0_.name, item0_.fk_order ...
// Sau Ä‘Ã³, vá»›i tá»«ng Item, load PurchaseOrder
	from Item item0_
	select purchaseor0_.id ...
	from PurchaseOrder purchaseor0_
	where purchaseor0_.id=?
	â†’ Query Ä‘áº§u tiÃªn láº¥y Item, sau Ä‘Ã³ má»—i láº§n láº¡i query tiáº¿p PurchaseOrder theo id.

- FetchType.LAZY: Ä‘á»ƒ giáº£i quyáº¿t n+1 select, for @ManyToOne 
	+ Hibernate khÃ´ng load dá»¯ liá»‡u quan há»‡ ngay láº­p tá»©c, chá»‰ táº¡o má»™t proxy (Ä‘á»‘i tÆ°á»£ng giáº£).
	+ Khi báº¡n thá»±c sá»± truy cáº­p Ä‘áº¿n dá»¯ liá»‡u quan há»‡, Hibernate má»›i cháº¡y SQL Ä‘á»ƒ láº¥y tá»« DB.
	@Entity
	public class Item { 
	    @ManyToOne(fetch = FetchType.LAZY)
	    @JoinColumn(name = "fk_order")
	    private PurchaseOrder order;
	}
	Khi Ä‘á»ƒ LAZY, Hibernate khÃ´ng tá»± Ä‘á»™ng load PurchaseOrder. NÃ³ chá»‰ load khi báº¡n thá»±c sá»± gá»i item.getOrder().
- JOIN FETCH:
	@ManyToOne máº·c Ä‘á»‹nh lÃ  EAGER â†’ dá»… gÃ¢y N+1 query.
	Báº¡n Ä‘á»•i sang LAZY Ä‘á»ƒ trÃ¡nh N+1 â†’ nhÆ°ng náº¿u báº¡n cáº§n load luÃ´n quan há»‡ thÃ¬ sao?
		
	List<Item> items = em.createQuery("SELECT i FROM Item i JOIN FETCH i.order", Item.class).getResultList();
	
	ğŸ«µ i = entity Item
	   JOIN FETCH i.order = báº£o Hibernate: â€œjoin luÃ´n báº£ng purchase_order vÃ  tráº£ vá» dá»¯ liá»‡u Ä‘áº§y Ä‘á»§ Ä‘á»ƒ khá»Ÿi táº¡o field order cá»§a Itemâ€.
		Hibernate sáº½ dá»‹ch thÃ nh SQL kiá»ƒu:
		select i.id, i.name, i.fk_order,
		       po.id, po.version
		from item i
		join purchase_order po on i.fk_order = po.id;
		. Káº¿t quáº£
			Tráº£ vá» List<Item> (giá»‘ng nhÆ° bÃ¬nh thÆ°á»ng), má»—i Item trong list Ä‘Ã£ cÃ³ order Ä‘Æ°á»£c load sáºµn.
			Hibernate khÃ´ng pháº£i cháº¡y thÃªm query phá»¥ khi báº¡n gá»i item.getOrder().

- @ManyToMany
Mapping trong UserEntity:

@ManyToMany(fetch = FetchType.LAZY)
@JoinTable(
    name = "user_role",                         // tÃªn báº£ng trung gian trong DB
    joinColumns = @JoinColumn(name = "userid"), // FK trá» vá» User
    inverseJoinColumns = @JoinColumn(name = "roleid") // FK trá» vá» Role
)
private List<RoleEntity> roles = new ArrayList<>();
Mapping ngÆ°á»£c trong RoleEntity (náº¿u muá»‘n 2 chiá»u):
@ManyToMany(mappedBy = "roles")
private List<UserEntity> users = new ArrayList<>();
ğŸ§© LÆ°u Ã½
	Náº¿u báº¡n khÃ´ng viáº¿t @JoinTable, Hibernate váº«n tá»± táº¡o báº£ng trung gian máº·c Ä‘á»‹nh cho quan há»‡ ManyToMany.
	NhÆ°ng khi báº¡n muá»‘n Ä‘iá»u khiá»ƒn tÃªn báº£ng/cá»™t (vÃ­ dá»¥ user_role, userid, roleid), thÃ¬ báº¡n pháº£i dÃ¹ng @JoinTable.
	@JoinColumn trong @JoinTable chÃ­nh lÃ  cá»™t foreign key trong báº£ng trung gian.
